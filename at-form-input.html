<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../at-core-theme/at-core-theme.html" />

<dom-module id="at-form-input">
  <template>
    <at-core-theme></at-core-theme>
    <div class="ui form">
      <div id="field" class="field">
        <label id="label">{{label}}</label>
        <input id="input" name$="{{name}}" type$="{{type}}" placeholder$="{{placeholder}}" value$="{{value}}" disabled$="{{disabled}}" />
      </div>
    </div>
  </template>


  <script>
    "use strict";
    Polymer({
      is: 'at-form-input',
      properties: {
        value: {
          type: String,
          value: '',
          notify: true,
          observer: 'valueChanged'
        },
        name: {
          type: String,
          value: ''
        },
        type: {
          type: String,
          value: 'text'
        },
        disabled: {
          type: Boolean,
          value: false,
          observer: 'disabledChanged'
        },
        valid: {
          type: Boolean,
          value: true,
          observer: 'validChanged',
          readOnly: true,
          notify: true
        },
        required: {
          type: Boolean,
          value: false,
          observer: 'requiredChanged'
        },
        label: {
          type: String,
          value: ''
        },
        placeholder: {
          type: String,
          value: ''
        }
      },
      ready: function () {
        var _self = this;
        this.$.input.addEventListener('change', function (e) {
          _self.value = _self.$.input.value;
        });
      },
      valueChanged: function (n, o) {
        this.$.input.value = n;
        this.updateValidState();
      },
      updateValidState: function () {
        var newValue = this.required ? (this.value !== undefined && this.value !== '') : true;
        this._setValid(newValue);
      },
      validChanged: function (newValue, oldValue) {
        this.toggleClass('error', !newValue, this.$.field);
      },
      requiredChanged: function () {
        this.updateValidState();
      },
      disabledChanged: function () {
        if (this.disabled) {
          this.$.input.setAttribute('disabled', 'true');
        } else {
          this.$.input.removeAttribute('disabled');
        }
      }
    });
  </script>
</dom-module>