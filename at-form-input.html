<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../at-core-theme/at-core-theme.html" />

<dom-module id="at-form-input">
  <template>
    <at-core-theme></at-core-theme>
    <div class="ui form">
      <div id="field" class="field">
        <label id="label">{{label}}</label>
        <input id="input" name$="{{name}}" type$="{{type}}" placeholder$="{{placeholder}}" value$="{{value}}" disabled$="{{disabled}}" />
      </div>
    </div>
  </template>


  <script>
    "use strict";
    Polymer({
      is: 'at-form-input',
      properties: {
        value: {
          type: String,
          value: '',
          reflectToAttribute: true,
          notify: true,
          observer: 'valueChanged'
        },
        name: {
          type: String,
          value: '',
          reflectToAttribute: true,
          notify: true
        },
        type: {
          type: String,
          value: 'text',
          reflectToAttribute: true
        },
        disabled: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
        invalid: {
          type: Boolean,
          value: false,
          reflectToAttribute: true,
          observer: 'invalidChanged',
          notify: true
        },
        required: {
          type: Boolean,
          value: false
        },
        label: {
          type: String,
          value: '',
          reflectToAttribute: true
        },
        placeholder: {
          type: String,
          value: '',
          reflectToAttribute: true
        }
      },
      ready: function () {
        var _self = this;
        this.$.input.addEventListener('change', function (e) {
          _self.value = _self.$.input.value;
        });
      },
      valueChanged: function (n, o) {
        this.$.input.value = n;
        this.updateValidState();
      },
      updateValidState: function () {
        this.invalid = this.required && (this.value === undefined || this.value === '');
      },
      invalidChanged: function (newValue, oldValue) {
        this.toggleClass('error', newValue, this.$.field);
      }
    });
  </script>
</dom-module>